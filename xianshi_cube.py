import numpy as np
import random
import numpy as np
import trimesh
from mesh_to_sdf import mesh_to_voxels
import pyrender
import time
#####################################################此文件用于画图，cube primitive和原object##################################
# 加载对象 mesh
object_mesh = trimesh.load('/home/dermark/objtrans/grab/grabtestout/duck/duck.obj')
voxels_object = mesh_to_voxels(object_mesh, 30, pad=True)
# 初始解和温度
x=5.13944735462078
y=3.3271207803449414
w=2.811425011282391
t1=-2.745977496800167
t2=-2.0689968216078385
t3=-2.289545913571814
x=2.916737497285549
y=1.2548004906513242
w=2.161713768681693
t1=1.1679712931923076
t2=-3.7758725470398464
t3=2.05003452696299
x=4.765211875985223
y=2.508849135531106
w=3.986893602003976
t1=2.7926494295242144
t2=2.1543432696282636
t3=-4.4428449373448196
x=2.479766655613498
y=1.8142645838567169
w=3.561444709000101
t1=0.42393312715560705
t2=0.4300717921790109
t3=-0.9715166530392261
x=3.3579479477950818
y=5.749626097813288
w=3.8954893813295577
t1=-0.5828090667210705
t2=0.1956692830279425
t3=-1.4271250196200218
x=3.605798551041734
y=5.330639636598402
w=4.020362548359087
t1=-0.03862519818487686
t2=-0.04781791809265967
t3=-1.0496743631928918
x=5.3421036951567675
y=4.72728976606672
w=5.881036185285472
t1=-0.03765137620312187
t2=-0.17707663458933787
t3=-0.48461594902817096
x=7.520248804602096
y=4.194035200092358
w=7.272318779577218
t1=0.5508425988304525
t2=-0.33083291438682705
t3=-1.1700217610778392
x=7.713486555835774
y=5.206145082367535
w=8.246653633494821
t1=-0.0962081090649014
t2=-0.14902504153258622
t3=-1.4245744324247671
x=8.15318342275885
y=4.8763205611679945
w=8.029309630460533
t1=-0.23508009672808305
t2=0.17920718076881692
t3=-0.7247225063635891
x=8.817221654392675
y=4.393540353623604
w=7.992805027523183
t1=-0.24726930743230902
t2=-0.14605072475892333
t3=-0.896465269146215
x=6.9370919011125505
y=4.981344083510901
w=7.21879117614952
t1=-0.5700633235796173
t2=-0.006595600981153915
t3=-0.9387859970484065
x=7.545727017788611
y=4.853116315352922
w=7.614839009220039
t1=-0.35600029860710525
t2=-0.02061157359305303
t3=-0.8352977851717428
###############################################################wucanrou.obj IOU=89%##########################################################################################################################################
x=9.065058159375845
y=5.011583986009086
w=7.632967616725113
t1=-0.24703134745961594
t2=-0.04730177695178965
t3=-0.9079662737353613
#########################################################################################################################################################################################################
x=0.10924147846711488
y=0.4535414062876644
w=0.33908729632955925
t1=-0.027646275762979868
t2=0.08180702080191529
t3=0.03190064550486962
x=0.025218383767046337
y=0.062285820043903935
w=0.026429592071755943
t1=-0.008033353287782225
t2=-0.02160205982760214
t3=0.007722712160755357
x=0.029649602662919904
y=0.021346274820739412
w=0.04392969521388162
t1=-0.006035642896769917
t2=-0.0002161655552837627
t3=-0.002204797014611015
x=0.04551787173821258
y=0.04633228047121488
w=0.10866461214524875
t1=-0.002075948097282265
t2=0.003964954932779501
t3=-0.009308518311800703
x=0.04830916368754239
y=0.03829287797817423
w=0.10936250748174071
t1=-0.0012777740354268617
t2=-0.00030372574834446265
t3=-0.016723972929616145
#############################################################milk_cube.obj IOU=0.75############################################################################################################################################
x=0.049926478827075266
y=0.03772258393173206
w=0.1103478189225535
t1=-0.0006408552331349965
t2=8.231149127958601e-06
t3=-0.017834210012684426
##############################################################bear_cube.obj IOU=0.75##################################################################################################################################
# x=0.040834092416561135
# y=0.05286095699024227
# w=0.10340703439822968
# t1=0.0005892848710407954
# t2=0.008086997450364114
# t3=-0.01395922804661816
##############################################################elephant.obj IOU=0.4#######################################################
x=0.08075167810677741
y=0.06681135105098987
w=0.04792364459451564
t1=0.01863334239479237
t2=0.004457947664765955
t3=0.0136539619003039
x=0.07916913775969268
y=0.06134422877219449
w=0.07375881099594501
t1=0.006979934869055604
t2=0.0024522061820076956
t3=0.008725293477304896
x=0.0863899340038107
y=0.05713638379041901
w=0.0715346275314326
t1=0.008668269074325463
t2=-4.14762145262437e-05
t3=0.008834076194377564
x=0.0863899340038107
y=0.05713638379041901
w=0.0715346275314326
t1=0.008668269074325463
t2=-4.14762145262437e-05
t3=0.008834076194377564
##############################################################elephant.obj IOU=0.6#######################################################
x=0.09320135466094474
y=0.05232480302315861
w=0.07171395726559202
t1=0.0079229411440878
t2=0.000982541956648435
t3=0.009414328386886592
##############################################################duck.obj IOU=0.55#######################################################
x=0.07546296111470215
y=0.046540706229681955
w=0.08149108261265257
t1=-4.522645507427708e-05
t2=-0.002365694692405288
t3=-0.006804504741997466
size=[x, y, w]
transform=np.array([
            [1, 0, 0, t1],
            [0, 1, 0, t2],
            [0, 0, 1, t3],
            [0, 0, 0, 1]
        ])


# 创建 pyrender 场景
scene = pyrender.Scene()
camera = pyrender.PerspectiveCamera(yfov=np.pi / 2)
camera_pose = np.array([
    [1.0, 0.0, 0.0, 0],
    [0.0, 1.0, 0.0, 0],
    [0.0, 0.0, 1.0, 2.0],
    [0.0, 0.0, 0.0, 1.0]
])
scene.add(camera, pose=camera_pose)
cuboid = trimesh.creation.box(extents=size,transform=transform)


#cuboid=trimesh.load('/home/dermark/objtrans/kan2.obj')

# 为透明物体设置材质并启用 alpha 混合
material = pyrender.MetallicRoughnessMaterial(
    baseColorFactor=(1.0, 0.0, 0.0, 0.2),  # 半透明红色
    alphaMode='BLEND'  # 启用透明度混合
)

material2 = pyrender.MetallicRoughnessMaterial(
    baseColorFactor=(0.0, 1.0, 1.0, 1.0),  # 半透明红色
    alphaMode='BLEND'  # 启用透明度混合
)
#object_pyrender = pyrender.Mesh.from_trimesh(object_mesh,material=material)



mesh=pyrender.Mesh.from_trimesh(cuboid, material=material2,smooth=False)
mesh_node = scene.add(mesh)
objectt=pyrender.Mesh.from_trimesh(object_mesh, material=material,smooth=False)
obj_node = scene.add(objectt)





viewer = pyrender.Viewer(scene, use_raymond_lighting=True, point_size=2, run_in_thread=True,render_transparent=True)

#cuboid.export("duckboid.obj")
